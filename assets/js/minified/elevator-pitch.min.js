class ElevatorPitchController{constructor(){this.video=document.getElementById("elevator-pitch-video"),this.overlay=document.getElementById("video-overlay"),this.playButton=document.getElementById("play-button"),this.videoWrapper=document.querySelector(".video-wrapper"),this.isPlaying=!1,this.hasStarted=!1,this.viewStartTime=null,this.init()}init(){this.video&&this.overlay&&this.playButton?(this.setupEventListeners(),this.setupVideoSecurity(),this.preloadVideo(),console.debug("[ElevatorPitchController] Initialized")):console.warn("[ElevatorPitchController] Video elements not found")}setupEventListeners(){this.playButton.addEventListener("click",()=>this.playVideo()),this.overlay.addEventListener("click",()=>this.playVideo()),this.video.addEventListener("loadstart",()=>this.onLoadStart()),this.video.addEventListener("loadedmetadata",()=>this.onMetadataLoaded()),this.video.addEventListener("play",()=>this.onPlay()),this.video.addEventListener("pause",()=>this.onPause()),this.video.addEventListener("ended",()=>this.onEnded()),this.video.addEventListener("error",e=>this.onError(e)),this.video.addEventListener("contextmenu",e=>e.preventDefault()),this.video.addEventListener("dragstart",e=>e.preventDefault()),this.video.addEventListener("selectstart",e=>e.preventDefault()),this.video.addEventListener("timeupdate",()=>this.onTimeUpdate()),document.addEventListener("keydown",e=>this.handleKeyboard(e))}setupVideoSecurity(){this.video.setAttribute("oncontextmenu","return false;"),this.video.setAttribute("draggable","false"),this.video.setAttribute("controlslist","nodownload noremoteplayback"),this.video.setAttribute("disablepictureinpicture","true"),this.monitorSuspiciousActivity()}preloadVideo(){this.video.preload="metadata",this.videoWrapper.classList.add("loading")}async playVideo(){try{this.hasStarted||(this.trackVideoStart(),this.hasStarted=!0),await this.video.play(),this.hideOverlay(),this.isPlaying=!0}catch(e){console.error("[ElevatorPitchController] Play error:",e),this.showError("Unable to play video. Please try again.")}}pauseVideo(){this.video.pause(),this.isPlaying=!1}hideOverlay(){this.overlay.classList.add("hidden")}showOverlay(){this.overlay.classList.remove("hidden")}onLoadStart(){this.videoWrapper.classList.add("loading"),console.debug("[ElevatorPitchController] Video loading started")}onMetadataLoaded(){this.videoWrapper.classList.remove("loading");const e=this.formatDuration(this.video.duration),t=document.querySelector(".video-duration");t&&this.video.duration&&(t.textContent=e),console.debug("[ElevatorPitchController] Video metadata loaded")}onPlay(){this.hideOverlay(),this.isPlaying=!0,this.viewStartTime=Date.now(),console.debug("[ElevatorPitchController] Video playing")}onPause(){this.isPlaying=!1,this.video.ended||this.showOverlay(),console.debug("[ElevatorPitchController] Video paused")}onEnded(){this.isPlaying=!1,this.showOverlay(),this.trackVideoComplete(),console.debug("[ElevatorPitchController] Video ended")}onError(e){console.error("[ElevatorPitchController] Video error:",e),this.showError("Video playback error. Please refresh and try again.")}onTimeUpdate(){if(!this.video.duration||!this.hasStarted)return;const e=this.video.currentTime/this.video.duration*100;e>=25&&!this.tracked25?(this.trackVideoProgress(25),this.tracked25=!0):e>=50&&!this.tracked50?(this.trackVideoProgress(50),this.tracked50=!0):e>=75&&!this.tracked75&&(this.trackVideoProgress(75),this.tracked75=!0)}handleKeyboard(e){if(this.isVideoInViewport()&&document.activeElement===this.video)switch(e.code){case"Space":e.preventDefault(),this.isPlaying?this.pauseVideo():this.playVideo();break;case"Escape":this.isPlaying&&this.pauseVideo()}}isVideoInViewport(){const e=this.video.getBoundingClientRect();return e.top>=0&&e.bottom<=window.innerHeight}monitorSuspiciousActivity(){let e={open:!1};if(setInterval(()=>{window.outerHeight-window.innerHeight>200||window.outerWidth-window.innerWidth>200?e.open||(console.warn("[Security] Developer tools detected"),e.open=!0):e.open=!1},1e3),navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia){const e=navigator.mediaDevices.getDisplayMedia;navigator.mediaDevices.getDisplayMedia=function(...t){return console.warn("[Security] Screen capture attempt detected"),e.apply(this,t)}}}trackVideoStart(){this.sendAnalytics("video_start",{video:"elevator-pitch",timestamp:Date.now(),userAgent:navigator.userAgent,referrer:document.referrer})}trackVideoProgress(e){this.sendAnalytics("video_progress",{video:"elevator-pitch",progress:e,timestamp:Date.now()})}trackVideoComplete(){const e=this.viewStartTime?Date.now()-this.viewStartTime:0;this.sendAnalytics("video_complete",{video:"elevator-pitch",watchTime:e,timestamp:Date.now()})}sendAnalytics(e,t){"undefined"!=typeof gtag&&gtag("event",e,t),console.debug(`[Analytics] ${e}:`,t)}formatDuration(e){if(!e||isNaN(e))return"0:00";return`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`}showError(e){const t=document.createElement("div");t.className="video-error",t.innerHTML=`\n            <i class="fas fa-exclamation-triangle"></i>\n            <span>${e}</span>\n        `,this.videoWrapper.appendChild(t),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},5e3)}}document.addEventListener("DOMContentLoaded",()=>{new ElevatorPitchController}),"undefined"!=typeof module&&module.exports&&(module.exports=ElevatorPitchController);