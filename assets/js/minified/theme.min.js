class ThemeController{#e=null;#t=null;#o=null;static THEMES=Object.freeze({LIGHT:"light",DARK:"dark"});static STORAGE_KEY="portfolio-theme";static ATTRIBUTE_NAME="data-theme";constructor(){this.#e=document.getElementById("theme-toggle"),this.#t=window.matchMedia("(prefers-color-scheme: dark)"),this.init()}async init(){this.#e?(await this.#r(),this.#l(),console.debug("[ThemeController] Initialized")):console.warn("[ThemeController] Theme toggle button not found")}async#r(){const e=await this.#n(),t=this.#s(),o=e||t;await this.#a(o)}#l(){this.#e.addEventListener("click",async()=>{try{const e=this.#m()===ThemeController.THEMES.LIGHT?ThemeController.THEMES.DARK:ThemeController.THEMES.LIGHT;await this.#a(e),await this.#h(e),console.debug(`[ThemeController] Theme toggled to ${e}`)}catch(e){console.error("[ThemeController] Error toggling theme:",e)}}),this.#t.addEventListener("change",async e=>{try{if(!await this.#n()){const t=e.matches?ThemeController.THEMES.DARK:ThemeController.THEMES.LIGHT;await this.#a(t),console.debug(`[ThemeController] System theme changed to ${t}`)}}catch(e){console.error("[ThemeController] Error handling system theme change:",e)}}),document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.shiftKey&&"d"===e.key.toLowerCase()&&(e.preventDefault(),this.toggleTheme())})}async#a(e){if(!Object.values(ThemeController.THEMES).includes(e))throw new Error(`Invalid theme: ${e}`);this.#o=e,document.documentElement.style.transition="background-color 0.3s ease, color 0.3s ease",e===ThemeController.THEMES.LIGHT?document.documentElement.setAttribute(ThemeController.ATTRIBUTE_NAME,"light"):document.documentElement.removeAttribute(ThemeController.ATTRIBUTE_NAME),await Promise.all([this.#T(e),this.#i(e),this.#c(e)]),setTimeout(()=>{document.documentElement.style.transition=""},300)}async#T(e){const t=this.#e.querySelector("i");t&&(t.style.transform="rotate(180deg)",await Utils.wait(150),e===ThemeController.THEMES.LIGHT?t.className="fas fa-moon":t.className="fas fa-sun",await Utils.wait(150),t.style.transform="rotate(0deg)")}async#i(e){const t=e===ThemeController.THEMES.LIGHT?"Switch to dark theme":"Switch to light theme";this.#e.setAttribute("aria-label",t),this.#e.setAttribute("title",t),this.#e.setAttribute("aria-pressed","false")}async#c(e){const t=new CustomEvent("themechange",{detail:{theme:e,timestamp:Date.now()},bubbles:!0});document.dispatchEvent(t)}#m(){return document.documentElement.hasAttribute(ThemeController.ATTRIBUTE_NAME)?ThemeController.THEMES.LIGHT:ThemeController.THEMES.DARK}async#n(){try{if(!Utils.supportsFeature("localStorage"))return null;const e=localStorage.getItem(ThemeController.STORAGE_KEY);return e&&Object.values(ThemeController.THEMES).includes(e)?e:null}catch(e){return console.warn("[ThemeController] Could not access localStorage:",e),null}}async#h(e){try{if(!Utils.supportsFeature("localStorage"))return void console.warn("[ThemeController] localStorage not supported");localStorage.setItem(ThemeController.STORAGE_KEY,e),localStorage.setItem(`${ThemeController.STORAGE_KEY}-timestamp`,Date.now().toString())}catch(e){console.warn("[ThemeController] Could not save to localStorage:",e)}}#s(){return this.#t.matches?ThemeController.THEMES.DARK:ThemeController.THEMES.LIGHT}getCurrentTheme(){return this.#o||this.#m()}async setTheme(e){if(!Object.values(ThemeController.THEMES).includes(e))throw new Error(`Invalid theme: ${e}. Must be one of: ${Object.values(ThemeController.THEMES).join(", ")}`);await this.#a(e),await this.#h(e)}async toggleTheme(){const e=this.getCurrentTheme()===ThemeController.THEMES.LIGHT?ThemeController.THEMES.DARK:ThemeController.THEMES.LIGHT;await this.setTheme(e)}async resetToSystemTheme(){try{localStorage.removeItem(ThemeController.STORAGE_KEY),localStorage.removeItem(`${ThemeController.STORAGE_KEY}-timestamp`);const e=this.#s();await this.#a(e),console.debug("[ThemeController] Reset to system theme:",e)}catch(e){console.error("[ThemeController] Error resetting to system theme:",e)}}getThemeStats(){try{const e=localStorage.getItem(ThemeController.STORAGE_KEY),t=localStorage.getItem(`${ThemeController.STORAGE_KEY}-timestamp`);return{currentTheme:this.getCurrentTheme(),savedTheme:e,systemTheme:this.#s(),lastChanged:t?new Date(parseInt(t)):null,hasCustomPreference:!!e}}catch(e){return console.warn("[ThemeController] Could not get theme stats:",e),null}}handleVisibilityChange(e){e?setTimeout(()=>{document.documentElement.style.transition=""},100):document.documentElement.style.transition="none"}}