<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Testimonials Test Page</title>
    <link rel="stylesheet" href="assets/css/portfolio.css">
    <style>
        /* Minimal reset and base styles for testing */
        :root {
            /* Colors */
            --bg-primary: #f8f9fa;
            --bg-secondary: #ffffff;
            --bg-card: #ffffff;
            --text-primary: #2d3748;
            --text-secondary: #4a5568;
            --text-muted: #718096;
            --accent-color: #4f46e5;
            --border-color: #e2e8f0;
            
            /* Spacing */
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            --spacing-2xl: 3rem;
            --spacing-3xl: 4rem;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            
            /* Transitions */
            --transition-fast: 0.2s ease;
            --transition-base: 0.3s ease;
            --transition-slow: 0.5s ease;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
        }
        
        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        
        header {
            padding: 2rem 0;
            background-color: var(--bg-secondary);
            box-shadow: var(--shadow-sm);
        }
        
        h1 {
            font-size: 2rem;
            margin-bottom: 1rem;
        }
        
        .test-controls {
            margin: 2rem 0;
            padding: 1rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--bg-secondary);
        }
        
        .test-controls button {
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .sample-data {
            margin-top: 3rem;
            padding: 1rem;
            background-color: var(--bg-card);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        
        pre {
            background-color: #f1f5f9;
            padding: 1rem;
            border-radius: 6px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Testimonials Component Test</h1>
            <p>This page allows you to test the testimonials component with different data scenarios.</p>
        </div>
    </header>
    
    <main class="container">
        <div class="test-controls">
            <h2>Test Controls</h2>
            <button id="loadData">Load Sample Data</button>
            <button id="loadEmpty">Show Empty State</button>
            <button id="loadError">Show Error State</button>
            <button id="toggleForm">Toggle Form</button>
        </div>
        
        <!-- Testimonial Section -->
        <section id="testimonials" class="testimonials">
            <h2>Testimonials</h2>
            <div class="testimonial-slider" aria-live="polite">
                <!-- Testimonials will be dynamically inserted here -->
            </div>
            <button id="prevTestimonial" aria-label="Previous testimonial">&lt;</button>
            <button id="nextTestimonial" aria-label="Next testimonial">&gt;</button>
            <button id="addTestimonialBtn">Add Your Testimonial</button>

            <div id="testimonialFormContainer" class="hidden">
                <form id="testimonialForm" enctype="multipart/form-data">
                    <div class="form-group">
                        <label for="testimonialName">Name:</label>
                        <input type="text" id="testimonialName" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="testimonialImage">Profile Image:</label>
                        <input type="file" id="testimonialImage" name="image" accept="image/*" required>
                    </div>
                    <div class="form-group">
                        <label for="testimonialRating">Rating (1-5 stars):</label>
                        <input type="number" id="testimonialRating" name="rating" min="1" max="5" required>
                    </div>
                    <div class="form-group">
                        <label for="testimonialText">Your Testimonial:</label>
                        <textarea id="testimonialText" name="testimonial" required></textarea>
                    </div>
                    <button type="submit">Submit Testimonial</button>
                </form>
            </div>
        </section>
        
        <div class="sample-data">
            <h2>Sample Data</h2>
            <pre id="dataSample">
[
  {
    "id": 1,
    "name": "John Smith",
    "rating": 5,
    "testimonial": "Working with Brahim was an amazing experience. His technical skills and attention to detail are impressive. The project was delivered on time and exceeded my expectations!",
    "image_url": "assets/images/profile-img.jpg",
    "created_at": "2023-10-15 14:30:00"
  },
  {
    "id": 2,
    "name": "Sarah Johnson",
    "rating": 4,
    "testimonial": "Brahim is a skilled developer who brought my website vision to life. His communication was excellent throughout the project.",
    "image_url": "assets/images/profile-img.jpg",
    "created_at": "2023-09-22 09:45:00"
  },
  {
    "id": 3,
    "name": "Michael Davis",
    "rating": 5,
    "testimonial": "I've worked with many developers, but Brahim stands out for his problem-solving abilities and dedication to quality. Highly recommended!",
    "image_url": "assets/images/profile-img.jpg",
    "created_at": "2023-08-05 16:20:00"
  },
  {
    "id": 4,
    "name": "Emily Wilson",
    "rating": 5,
    "testimonial": "Brahim turned our outdated website into a modern, responsive platform that has significantly increased our conversions. We couldn't be happier with the results!",
    "image_url": "assets/images/profile-img.jpg",
    "created_at": "2023-07-18 11:10:00"
  }
]
            </pre>
        </div>
    </main>

    <script>
        // Mock TestimonialSlider class for testing
        class TestimonialSlider {
            constructor() {
                this.currentTestimonial = 0;
                this.testimonials = [];
                this.numVisibleCards = 3;
                
                this.elements = {
                    slider: document.querySelector('.testimonial-slider'),
                    prevButton: document.getElementById('prevTestimonial'),
                    nextButton: document.getElementById('nextTestimonial'),
                    addButton: document.getElementById('addTestimonialBtn'),
                    formContainer: document.getElementById('testimonialFormContainer'),
                    form: document.getElementById('testimonialForm')
                };
                
                this.init();
            }
            
            init() {
                this.setupEventListeners();
                this.setupResponsiveCards();
            }
            
            setupEventListeners() {
                // Navigation buttons
                if (this.elements.prevButton) {
                    this.elements.prevButton.addEventListener('click', () => this.showPrevTestimonial());
                }
                
                if (this.elements.nextButton) {
                    this.elements.nextButton.addEventListener('click', () => this.showNextTestimonial());
                }
                
                // Add testimonial button
                if (this.elements.addButton) {
                    this.elements.addButton.addEventListener('click', () => this.toggleForm());
                }
                
                // Form submission
                if (this.elements.form) {
                    this.elements.form.addEventListener('submit', (e) => {
                        e.preventDefault();
                        alert('Form submitted (test mode)');
                    });
                }
                
                // Test controls
                document.getElementById('loadData').addEventListener('click', () => {
                    this.loadSampleData();
                });
                
                document.getElementById('loadEmpty').addEventListener('click', () => {
                    this.showEmptyState();
                });
                
                document.getElementById('loadError').addEventListener('click', () => {
                    this.showDatabaseError('Test error message');
                });
                
                document.getElementById('toggleForm').addEventListener('click', () => {
                    this.toggleForm();
                });
                
                // Window resize
                window.addEventListener('resize', () => {
                    this.setupResponsiveCards();
                    this.updateSliderPosition();
                });
            }
            
            setupResponsiveCards() {
                const viewportWidth = window.innerWidth;
                
                if (viewportWidth < 768) {
                    this.numVisibleCards = 1;
                } else if (viewportWidth < 1024) {
                    this.numVisibleCards = 2;
                } else {
                    this.numVisibleCards = 3;
                }
            }
            
            loadSampleData() {
                const sampleDataStr = document.getElementById('dataSample').textContent;
                try {
                    this.testimonials = JSON.parse(sampleDataStr);
                    this.displayTestimonials();
                    this.updateNavigationButtons();
                } catch (error) {
                    console.error('Error parsing sample data:', error);
                }
            }
            
            displayTestimonials() {
                if (!this.elements.slider || this.testimonials.length === 0) {
                    this.showEmptyState();
                    return;
                }
                
                this.elements.slider.innerHTML = this.testimonials.map(testimonial => `
                    <div class="testimonial-card" data-id="${testimonial.id}">
                        <img src="${testimonial.image_url}" 
                             alt="${this.escapeHtml(testimonial.name)}'s profile picture"
                             onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjZjBmMGYwIi8+Cjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE2IiBmaWxsPSIjOTk5IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5ObyBJbWFnZTwvdGV4dD4KPC9zdmc+'">
                        <div class="name">${this.escapeHtml(testimonial.name)}</div>
                        <div class="rating" aria-label="Rating: ${testimonial.rating} out of 5 stars">
                            ${this.generateStars(testimonial.rating)}
                        </div>
                        <p class="testimonial">${this.escapeHtml(testimonial.testimonial)}</p>
                        <div class="date">${this.formatDate(testimonial.created_at)}</div>
                    </div>
                `).join('');
                
                this.updateSliderPosition();
            }
            
            showEmptyState() {
                if (this.elements.slider) {
                    this.elements.slider.innerHTML = `
                        <div class="empty-state">
                            <p>No testimonials available yet.</p>
                            <p>Be the first to share your experience!</p>
                        </div>
                    `;
                }
            }
            
            showDatabaseError(message = 'Database error. Check logs.') {
                if (this.elements.slider) {
                    this.elements.slider.innerHTML = `
                        <div class="error-state">
                            <div style="font-size: 2rem; margin-bottom: 1rem;">⚠️</div>
                            <h3 style="margin-bottom: 1rem;">Database Connection Error</h3>
                            <p style="margin-bottom: 0.5rem;">${this.escapeHtml(message)}</p>
                            <p style="font-size: 0.9rem; opacity: 0.8;">Please check the server logs for more details.</p>
                        </div>
                    `;
                }
            }
            
            generateStars(rating) {
                const fullStars = '★'.repeat(Math.floor(rating));
                const emptyStars = '☆'.repeat(5 - Math.floor(rating));
                return fullStars + emptyStars;
            }
            
            formatDate(dateString) {
                if (!dateString) return '';
                
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
            }
            
            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
            
            updateSliderPosition() {
                if (!this.elements.slider || this.testimonials.length === 0) return;
                
                const card = this.elements.slider.querySelector('.testimonial-card');
                if (!card) return;
                
                const cardWidth = card.offsetWidth + 20; // Account for gap
                this.elements.slider.scrollTo({
                    left: this.currentTestimonial * cardWidth,
                    behavior: 'smooth'
                });
            }
            
            showNextTestimonial() {
                const maxIndex = Math.max(0, this.testimonials.length - this.numVisibleCards);
                
                if (this.currentTestimonial < maxIndex) {
                    this.currentTestimonial++;
                } else {
                    this.currentTestimonial = 0; // Loop back to start
                }
                
                this.updateSliderPosition();
                this.updateNavigationButtons();
            }
            
            showPrevTestimonial() {
                if (this.currentTestimonial > 0) {
                    this.currentTestimonial--;
                } else {
                    this.currentTestimonial = Math.max(0, this.testimonials.length - this.numVisibleCards);
                }
                
                this.updateSliderPosition();
                this.updateNavigationButtons();
            }
            
            updateNavigationButtons() {
                const maxIndex = Math.max(0, this.testimonials.length - this.numVisibleCards);
                
                if (this.elements.prevButton) {
                    this.elements.prevButton.disabled = this.testimonials.length <= this.numVisibleCards;
                }
                
                if (this.elements.nextButton) {
                    this.elements.nextButton.disabled = this.testimonials.length <= this.numVisibleCards;
                }
            }
            
            toggleForm() {
                if (!this.elements.formContainer) return;
                
                const isHidden = this.elements.formContainer.classList.contains('hidden');
                
                if (isHidden) {
                    this.elements.formContainer.classList.remove('hidden');
                    this.elements.addButton.textContent = 'Cancel';
                    this.elements.addButton.setAttribute('aria-expanded', 'true');
                } else {
                    this.elements.formContainer.classList.add('hidden');
                    this.elements.addButton.textContent = 'Add Your Testimonial';
                    this.elements.addButton.setAttribute('aria-expanded', 'false');
                }
            }
        }

        // Initialize the test component
        document.addEventListener('DOMContentLoaded', () => {
            new TestimonialSlider();
        });
    </script>
</body>
</html>
