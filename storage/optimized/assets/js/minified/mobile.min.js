/** * Mobile Controller * * Handles mobile navigation,responsive behavior,and touch interactions. * Includes accessibility features and smooth animations. * * @author Brahim El Houss */class MobileController{ constructor(){ this.navToggle = document.querySelector('.nav__toggle'); this.navMenu = document.querySelector('.nav__menu'); this.navLinks = document.querySelectorAll('.nav__link'); this.body = document.body; this.isMenuOpen = false; this.breakpoint = 992; this.init(); } /** * Initialize mobile functionality */ init(){ if(!this.navToggle || !this.navMenu){ console.warn('[MobileController] Navigation elements not found'); return; } this.setupEventListeners(); this.setupAccessibility(); this.addToggleStyles(); console.debug('[MobileController] Initialized'); } /** * Setup event listeners */ setupEventListeners(){ this.navToggle.addEventListener('click',(e)=>{ e.preventDefault(); this.toggleNavigation(); }); this.navLinks.forEach(link =>{ link.addEventListener('click',()=>{ if(this.isMenuOpen){ this.closeNavigation(); } }); }); document.addEventListener('click',(e)=> this.handleOutsideClick(e)); window.addEventListener('resize',()=> this.handleResize()); document.addEventListener('keydown',(e)=> this.handleKeyDown(e)); this.setupTouchEvents(); } /** * Setup accessibility features */ setupAccessibility(){ this.updateAriaAttributes(false); this.navToggle.setAttribute('role','button'); this.navToggle.setAttribute('aria-controls','nav-menu'); this.navMenu.setAttribute('role','navigation'); this.navMenu.id = 'nav-menu'; } /** * Toggle the mobile navigation */ toggleNavigation(){ this.isMenuOpen = !this.isMenuOpen; this.navMenu.classList.toggle('active',this.isMenuOpen); this.navToggle.classList.toggle('active',this.isMenuOpen); this.body.style.overflow = this.isMenuOpen ? 'hidden' : ''; this.updateAriaAttributes(this.isMenuOpen); this.announceMenuState(this.isMenuOpen); if(this.isMenuOpen){ this.trapFocus(); } else{ this.releaseFocus(); } console.debug(`[MobileController] Navigation ${ this.isMenuOpen ? 'opened' : 'closed'} `); } /** * Close the mobile navigation */ closeNavigation(){ if(!this.isMenuOpen)return; this.isMenuOpen = false; this.navMenu.classList.remove('active'); this.navToggle.classList.remove('active'); this.body.style.overflow = ''; this.updateAriaAttributes(false); this.releaseFocus(); console.debug('[MobileController] Navigation closed'); } /** * Handle clicks outside the navigation */ handleOutsideClick(e){ if(!this.isMenuOpen)return; if(!this.navMenu.contains(e.target)&& !this.navToggle.contains(e.target)){ this.closeNavigation(); } } /** * Handle window resize events */ handleResize(){ if(window.innerWidth >= this.breakpoint && this.isMenuOpen){ this.closeNavigation(); } } /** * Handle keyboard events */ handleKeyDown(e){ if(e.key === 'Escape' && this.isMenuOpen){ this.closeNavigation(); this.navToggle.focus(); } if(this.isMenuOpen && e.key === 'Tab'){ this.handleTabNavigation(e); } } /** * Handle tab navigation within mobile menu */ handleTabNavigation(e){ const focusableElements = this.navMenu.querySelectorAll( 'a,button,[tabindex]:not([tabindex="-1"])'); const firstElement = focusableElements[0]; const lastElement = focusableElements[focusableElements.length - 1]; if(e.shiftKey){ if(document.activeElement === firstElement){ e.preventDefault(); lastElement.focus(); } } else{ if(document.activeElement === lastElement){ e.preventDefault(); firstElement.focus(); } } } /** * Trap focus within mobile menu */ trapFocus(){ const firstFocusable = this.navMenu.querySelector('a,button'); if(firstFocusable){ setTimeout(()=> firstFocusable.focus(),100); } } /** * Release focus from mobile menu */ releaseFocus(){ this.navToggle.focus(); } /** * Update ARIA attributes for accessibility */ updateAriaAttributes(isOpen){ this.navToggle.setAttribute('aria-expanded',isOpen ? 'true' : 'false'); this.navToggle.setAttribute('aria-label',isOpen ? 'Close menu' : 'Open menu'); this.navMenu.setAttribute('aria-hidden',isOpen ? 'false' : 'true'); } /** * Announce menu state to screen readers */ announceMenuState(isOpen){ const announcement = document.createElement('div'); announcement.setAttribute('aria-live','polite'); announcement.setAttribute('aria-atomic','true'); announcement.className = 'sr-only'; announcement.textContent = isOpen ? 'Menu opened' : 'Menu closed'; document.body.appendChild(announcement); setTimeout(()=>{ if(announcement.parentNode){ announcement.parentNode.removeChild(announcement); } },1000); } /** * Setup touch events for better mobile UX */ setupTouchEvents(){ let startY = 0; let endY = 0; this.navMenu.addEventListener('touchstart',(e)=>{ startY = e.touches[0].clientY; }); this.navMenu.addEventListener('touchend',(e)=>{ endY = e.changedTouches[0].clientY; if(startY - endY > 100){ this.closeNavigation(); } }); this.navMenu.addEventListener('touchmove',(e)=>{ if(this.isMenuOpen){ e.preventDefault(); } },{ passive: false}); } /** * Add CSS styles for burger toggle animation */ addToggleStyles(){ if(document.querySelector('#mobile-nav-styles'))return; const styles = ` .nav__toggle{ display: flex; flex-direction: column; justify-content: center; width: 30px; height: 30px; background: transparent; border: none; cursor: pointer; padding: 0; z-index: 1001; transition: transform 0.3s ease; } .nav__toggle:hover{ transform: scale(1.1); } .nav__toggle-bar{ width: 100%; height: 2px; background: var(--text-color); margin: 3px 0; transition: all 0.3s cubic-bezier(0.4,0,0.2,1); transform-origin: center; } .nav__toggle.active .nav__toggle-bar:nth-child(1){ transform: rotate(45deg)translate(6px,6px); } .nav__toggle.active .nav__toggle-bar:nth-child(2){ opacity: 0; transform: scale(0); } .nav__toggle.active .nav__toggle-bar:nth-child(3){ transform: rotate(-45deg)translate(6px,-6px); } @media(min-width: 992px){ .nav__toggle{ display: none; } } .nav__menu.active{ transform: translateX(0); opacity: 1; visibility: visible; } @media(max-width: 991px){ .nav__menu{ position: fixed; top: 0; right: 0; width: 100%; height: 100vh; background: var(--bg-color); display: flex; flex-direction: column; justify-content: center; align-items: center; transform: translateX(100%); opacity: 0; visibility: hidden; transition: all 0.3s cubic-bezier(0.4,0,0.2,1); z-index: 1000; padding: 2rem; } .nav__item{ margin: 1rem 0; opacity: 0; transform: translateY(20px); transition: all 0.3s cubic-bezier(0.4,0,0.2,1); } .nav__menu.active .nav__item{ opacity: 1; transform: translateY(0); } .nav__menu.active .nav__item:nth-child(1){ transition-delay: 0.1s; } .nav__menu.active .nav__item:nth-child(2){ transition-delay: 0.2s; } .nav__menu.active .nav__item:nth-child(3){ transition-delay: 0.3s; } .nav__menu.active .nav__item:nth-child(4){ transition-delay: 0.4s; } .nav__menu.active .nav__item:nth-child(5){ transition-delay: 0.5s; } .nav__menu.active .nav__item:nth-child(6){ transition-delay: 0.6s; } .nav__link{ font-size: 1.5rem; font-weight: 500; text-align: center; padding: 1rem; display: block; width: 100%; } } .sr-only{ position: absolute !important; width: 1px !important; height: 1px !important; padding: 0 !important; margin: -1px !important; overflow: hidden !important; clip: rect(0,0,0,0)!important; white-space: nowrap !important; border: 0 !important; } `; const styleSheet = document.createElement('style'); styleSheet.id = 'mobile-nav-styles'; styleSheet.textContent = styles; document.head.appendChild(styleSheet); } /** * Check if device is mobile */ isMobile(){ return window.innerWidth < this.breakpoint; } /** * Handle resize events(called by main app) */ handleResize(){ } /** * Get menu state */ isMenuOpen(){ return this.isMenuOpen; } /** * Force close menu(for programmatic control) */ forceClose(){ if(this.isMenuOpen){ this.closeNavigation(); } } /** * Cleanup method */ destroy(){ document.removeEventListener('click',this.handleOutsideClick); window.removeEventListener('resize',this.handleResize); document.removeEventListener('keydown',this.handleKeyDown); this.body.style.overflow = ''; const styles = document.getElementById('mobile-nav-styles'); if(styles){ styles.remove(); } } } 