class TestimonialController{constructor(t="./src/api",e=8e3){this.apiBaseUrl=t,this.autoSlideInterval=e,this.currentTestimonial=0,this.testimonials=[],this.numVisibleCards=3,this.autoSlideTimer=null,this.isAutoPaused=!1,this.elements={slider:document.querySelector(".testimonial-slider"),prevButton:document.getElementById("prevTestimonial"),nextButton:document.getElementById("nextTestimonial"),addButton:document.getElementById("addTestimonialBtn"),formContainer:document.getElementById("testimonialFormContainer"),form:document.getElementById("testimonialForm")},this.init()}init(){this.elements.slider?(this.setupEventListeners(),this.setupResponsiveCards(),this.fetchTestimonials(),console.debug("[TestimonialController] Initialized")):console.warn("[TestimonialController] Testimonial slider not found")}setupEventListeners(){this.elements.prevButton&&this.elements.prevButton.addEventListener("click",(()=>this.showPrevTestimonial())),this.elements.nextButton&&this.elements.nextButton.addEventListener("click",(()=>this.showNextTestimonial())),this.elements.addButton&&this.elements.addButton.addEventListener("click",(()=>this.toggleForm())),this.elements.form&&this.elements.form.addEventListener("submit",(t=>this.handleFormSubmit(t))),window.addEventListener("resize",this.debounce((()=>{this.setupResponsiveCards(),this.updateSliderPosition()}),250)),this.elements.slider&&(this.elements.slider.addEventListener("mouseenter",(()=>this.pauseAutoSlide())),this.elements.slider.addEventListener("mouseleave",(()=>this.resumeAutoSlide()))),document.addEventListener("keydown",(t=>this.handleKeyboardNavigation(t))),this.setupTouchSupport()}setupResponsiveCards(){const t=window.innerWidth;this.numVisibleCards=t<768?1:t<1024?2:3,this.updateSliderPosition()}async fetchTestimonials(){if(this.isDevMode())this.loadSampleTestimonials();else try{const t=await fetch(`${this.apiBaseUrl}/get_testimonials.php`);if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const e=await t.json();if(!e.success)throw new Error(e.message||"API returned unsuccessful response");e.data&&Array.isArray(e.data.testimonials)?this.testimonials=e.data.testimonials:Array.isArray(e.testimonials)?this.testimonials=e.testimonials:this.testimonials=[],this.displayTestimonials(),this.updateNavigationButtons(),this.startAutoSlide(),console.log("[TestimonialController] Successfully loaded",this.testimonials.length,"testimonials")}catch(t){console.error("[TestimonialController] Fetch error:",t),this.showDatabaseError(t.message)}}isDevMode(){return"localhost"===location.hostname||"127.0.0.1"===location.hostname||""===location.hostname}loadSampleTestimonials(){this.testimonials=[{id:1,name:"Sarah Johnson",image:"assets/images/testimonials/sarah.jpg",rating:5,testimonial:"Brahim delivered exceptional work on our web application. His attention to detail and technical expertise made the project a huge success.",created_at:"2024-01-15"},{id:2,name:"Michael Chen",image:"assets/images/testimonials/michael.jpg",rating:5,testimonial:"Working with Brahim was a fantastic experience. He's professional, communicative, and delivers high-quality code on time.",created_at:"2024-02-01"},{id:3,name:"Emily Rodriguez",image:"assets/images/testimonials/emily.jpg",rating:5,testimonial:"Brahim's full-stack development skills are impressive. He transformed our ideas into a beautiful, functional website.",created_at:"2024-02-15"},{id:4,name:"David Thompson",image:"assets/images/testimonials/david.jpg",rating:4,testimonial:"Great developer with strong problem-solving skills. Would definitely recommend for any web development project.",created_at:"2024-03-01"}],this.displayTestimonials(),this.updateNavigationButtons(),this.startAutoSlide()}displayTestimonials(){if(!this.elements.slider||0===this.testimonials.length)return void this.showEmptyState();const t=this.testimonials.map((t=>this.createTestimonialHTML(t))).join("");this.elements.slider.innerHTML=t,this.updateSliderPosition()}createTestimonialHTML(t){const e=this.generateStars(t.rating),i=this.formatDate(t.created_at),s=this.escapeHtml(t.testimonial),n=this.escapeHtml(t.name),a=t.image_url||t.image||"assets/images/placeholder-avatar.svg";return`\n            <div class="testimonial-item" data-id="${t.id}">\n                <div class="testimonial-content">\n                    <div class="testimonial-rating">\n                        ${e}\n                    </div>\n                    <blockquote class="testimonial-text">\n                        "${s}"\n                    </blockquote>\n                    <div class="testimonial-author">\n                        <div class="testimonial-image">\n                            <img src="${a}" alt="${n}" loading="lazy" \n                                 onerror="this.src='assets/images/placeholder-avatar.svg'">\n                        </div>\n                        <div class="testimonial-details">\n                            <h4 class="testimonial-name">${n}</h4>\n                            <time class="testimonial-date" datetime="${t.created_at}">\n                                ${i}\n                            </time>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `}generateStars(t){let e="";for(let i=1;i<=5;i++)e+=i<=t?'<i class="fas fa-star"></i>':'<i class="far fa-star"></i>';return e}formatDate(t){try{return new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}catch(e){return t}}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}updateSliderPosition(){if(!this.elements.slider||0===this.testimonials.length)return;const t=100/this.numVisibleCards,e=-this.currentTestimonial*t;this.elements.slider.style.transform=`translateX(${e}%)`,this.elements.slider.style.transition="transform 0.5s cubic-bezier(0.4, 0, 0.2, 1)"}showNextTestimonial(){if(0===this.testimonials.length)return;const t=Math.max(0,this.testimonials.length-this.numVisibleCards);this.currentTestimonial=Math.min(this.currentTestimonial+1,t),this.updateSliderPosition(),this.updateNavigationButtons()}showPrevTestimonial(){0!==this.testimonials.length&&(this.currentTestimonial=Math.max(this.currentTestimonial-1,0),this.updateSliderPosition(),this.updateNavigationButtons())}updateNavigationButtons(){if(!this.elements.prevButton||!this.elements.nextButton)return;const t=Math.max(0,this.testimonials.length-this.numVisibleCards);this.elements.prevButton.disabled=0===this.currentTestimonial,this.elements.nextButton.disabled=this.currentTestimonial>=t,this.elements.prevButton.setAttribute("aria-label",`Previous testimonial (${this.currentTestimonial+1} of ${this.testimonials.length})`),this.elements.nextButton.setAttribute("aria-label",`Next testimonial (${this.currentTestimonial+1} of ${this.testimonials.length})`)}startAutoSlide(){this.testimonials.length<=this.numVisibleCards||(this.autoSlideTimer=setInterval((()=>{if(!this.isAutoPaused){const t=Math.max(0,this.testimonials.length-this.numVisibleCards);this.currentTestimonial>=t?this.currentTestimonial=0:this.currentTestimonial++,this.updateSliderPosition(),this.updateNavigationButtons()}}),this.autoSlideInterval))}stopAutoSlide(){this.autoSlideTimer&&(clearInterval(this.autoSlideTimer),this.autoSlideTimer=null)}pauseAutoSlide(){this.isAutoPaused=!0}resumeAutoSlide(){this.isAutoPaused=!1}handleKeyboardNavigation(t){if(t.target.closest(".testimonials"))switch(t.key){case"ArrowLeft":t.preventDefault(),this.showPrevTestimonial();break;case"ArrowRight":t.preventDefault(),this.showNextTestimonial();break;case"Home":t.preventDefault(),this.currentTestimonial=0,this.updateSliderPosition(),this.updateNavigationButtons();break;case"End":t.preventDefault(),this.currentTestimonial=Math.max(0,this.testimonials.length-this.numVisibleCards),this.updateSliderPosition(),this.updateNavigationButtons()}}setupTouchSupport(){if(!this.elements.slider)return;let t=0,e=0;this.elements.slider.addEventListener("touchstart",(e=>{t=e.touches[0].clientX})),this.elements.slider.addEventListener("touchend",(i=>{e=i.changedTouches[0].clientX,this.handleSwipe(t,e)}))}handleSwipe(t,e){const i=t-e;Math.abs(i)>50&&(i>0?this.showNextTestimonial():this.showPrevTestimonial())}toggleForm(){if(!this.elements.formContainer)return;this.elements.formContainer.classList.contains("hidden")?(this.elements.formContainer.classList.remove("hidden"),this.elements.addButton.textContent="Cancel"):(this.elements.formContainer.classList.add("hidden"),this.elements.addButton.textContent="Add Your Testimonial")}async handleFormSubmit(t){if(t.preventDefault(),this.isDevMode())return void alert("Testimonial form submission is disabled in development mode.");const e=new FormData(this.elements.form);try{const t=await fetch(`${this.apiBaseUrl}/add_testimonial.php`,{method:"POST",body:e}),i=await t.json();i.success?(alert("Thank you for your testimonial! It will be reviewed before being published."),this.elements.form.reset(),this.toggleForm()):alert(i.message||"Failed to submit testimonial. Please try again.")}catch(t){console.error("[TestimonialController] Form submission error:",t),alert("An error occurred. Please try again later.")}}showEmptyState(){this.elements.slider&&(this.elements.slider.innerHTML='\n            <div class="testimonials-empty">\n                <div class="empty-icon">\n                    <i class="fas fa-comments"></i>\n                </div>\n                <h3>No testimonials yet</h3>\n                <p>Be the first to share your experience!</p>\n            </div>\n        ')}showDatabaseError(t="Unable to load testimonials"){this.elements.slider&&(this.elements.slider.innerHTML=`\n            <div class="testimonials-error">\n                <div class="error-icon">\n                    <i class="fas fa-exclamation-triangle"></i>\n                </div>\n                <h3>Testimonials Unavailable</h3>\n                <p>${t}</p>\n                <button onclick="window.location.reload()" class="btn btn--secondary">\n                    Try Again\n                </button>\n            </div>\n        `)}debounce(t,e){let i;return function(...s){clearTimeout(i),i=setTimeout((()=>{clearTimeout(i),t(...s)}),e)}}handleResize(){this.setupResponsiveCards()}handleVisibilityChange(t){t?this.resumeAutoSlide():this.pauseAutoSlide()}destroy(){this.stopAutoSlide(),window.removeEventListener("resize",this.handleResize),document.removeEventListener("keydown",this.handleKeyboardNavigation)}}
//# sourceMappingURL=testimonials.min.js.map